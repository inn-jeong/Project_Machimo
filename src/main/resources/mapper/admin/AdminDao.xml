<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.project_machimo.admin.dao.AdminDao">

    <!--/////////유저 관리/////////-->
    <select id="adminList" resultType="com.example.project_machimo.admin.dto.UsersDto">
        <![CDATA[
                select * from (
                select rownum rn, temp.* from
                (select
                 user_id, u_id, u_nickname, u_email, u_point, u_created_at, u_role
                from users
                order by user_id desc ) temp
                where rownum <= ( #{pageNum} * #{amount}))
                where rn > (#{pageNum} -1) * #{amount}
        ]]>
    </select>

    <select id="getTotalCount" resultType="int">
        select count(*) from users
    </select>

    <update id="adminDelete">
            delete users where user_id=#{userId}
    </update>

    <update id="adminModify">
        update users set u_role=1 where user_id=#{userId}
    </update>

    <select id="userView" resultType="com.example.project_machimo.admin.dto.UsersDto">
        select u_id, u_nickname, u_password, u_name, u_jumin, u_phone, u_address from users where user_id = #{userId}
    </select>

    <!--/////////문의,공지/////////-->
    <select id="BoardList" resultType="com.example.project_machimo.admin.dto.BoardDto">
        <![CDATA[
                select * from (
                select rownum rn, temp.* from
                (select
                 board_id, b_category, b_title, b_writer, b_date, b_hit
                from board
                order by board_id desc ) temp
                where rownum <= ( #{pageNum} * #{amount}))
                where rn > (#{pageNum} -1) * #{amount}
        ]]>
    </select>

    <select id="boardView"  resultType="com.example.project_machimo.admin.dto.BoardDto">
        select board_id, inquiry_category, b_category, b_title, b_writer, b_date, b_content, b_hit from board where board_id = ${param1}
    </select>

    <update id="updateHits">
        update board set b_hit = b_hit+1 where board_id = #{boardId}
    </update>

    <insert id="boardWrite" parameterType="com.example.project_machimo.admin.dto.BoardDto">
        insert into board (board_id, b_category, inquiry_category, b_writer, b_title, b_content, b_date, user_id)
        VALUES ((select max(board_id)+1 from board), #{bCategory}, #{inquiryCategory}, #{bWriter}, #{bTitle}, #{bContent}, SYSDATE, #{userId})
    </insert>

    <update id="boardModify">
        update board set b_category = #{bCategory}, inquiry_category = #{inquiryCategory}, b_title = #{bTitle}, b_content = #{bContent}, b_date = SYSDATE where board_id = #{boardId}
    </update>

    <delete id="boardDelete">
        delete from board where board_id = #{boardId}
    </delete>

    <!--/////////제품관리/////////-->
    <select id="pList" resultType="com.example.project_machimo.admin.dto.ProductDto">
        SELECT p.product_id, p.p_name, ca.c_name, ca.c_name2, pi.i_sub_img, p.p_info, p.p_direct, p.p_b_price, p.p_created_at, p.p_updated_at, p.p_sales_status, p.p_sale_type
        FROM products p
        INNER JOIN product_images pi ON p.product_id = pi.product_id
        INNER JOIN category ca ON p.c_id = ca.c_id AND p.c_id2 = ca.c_id2
    </select>

    <update id="updateStatus">
        update products set
        p_sales_status= #{param2}
        where product_id=#{param1}
    </update>

<!-- 컬렉션타입이나 객체를 넘겨줄때 값들은 이름을 적을 수 있음,-->
<!--    나머지는 param을 순서대로 사용-->
    <delete id="productDelete">
        delete from products where product_id = #{param2}
    </delete>
</mapper>
