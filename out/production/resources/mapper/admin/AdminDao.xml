<!--<?xml version="1.0" encoding="UTF-8"?>-->
<!--<beans xmlns="http://www.springframework.org/schema/beans"-->
<!--       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"-->
<!--       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">-->
<!--</beans>-->

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.project_machimo.admin.dao.AdminDao">

    <select id="adminList" resultType="com.example.project_machimo.admin.dto.UsersDto">
        <![CDATA[
            SELECT user_id, u_id, u_nickname, u_email, u_point, u_created_at, u_role
                from (SELECT rownum rn, user_id, u_id, u_nickname, u_email, u_point, u_created_at, u_role
			              FROM users
			            WHERE rownum <= (#{pageNum} * #{amount})
			            order by user_id asc
			)
			WHERE rn > (#{pageNum}-1) * #{amount}
			order by user_id asc
		]]>
    </select>

    <select id="getTotalCount" resultType="int">
        select count(*) from users
    </select>

    <update id="adminDelete">
            delete users where user_id=#{user_id}
    </update>

    <update id="adminModify">
        update users set u_role=1 where user_id=#{user_id}
    </update>

    <select id="userView" resultType="com.example.project_machimo.admin.dto.UsersDto">
        select u_id, u_nickname, u_password, u_name, u_jumin, u_phone, u_address from users where user_id = #{user_id}
    </select>

    <!--문의,공지-->
    <select id="BoardList" resultType="com.example.project_machimo.admin.dto.BoardDto">
        <![CDATA[
            SELECT board_id, b_category, b_title, b_writer, b_date, b_hit
                from (SELECT rownum rn, board_id, b_category, b_title, b_writer, b_date, b_hit
			              FROM board
			            WHERE
			            rownum <= (#{pageNum} * #{amount})
			            order by board_id asc
			)
			WHERE rn > (#{pageNum}-1) * #{amount}
			order by board_id asc
		]]>

    </select>

    <insert id="boardWrite" parameterType="com.example.project_machimo.admin.dto.BoardDto">
        insert into board (board_id, b_category, b_title, b_content, user_id)
        VALUES ((select max(board_id)+1 from board), #{b_category}, #{b_title}, #{b_content}, #{user_id} )
    </insert>

    <select id="boardView"  resultType="com.example.project_machimo.admin.dto.BoardDto">
        select board_id, inquiry_category, b_category, b_title, b_writer, b_date, b_content, b_hit from board where board_id = ${param1}
    </select>

    <update id="updateHits">
        update board set b_hit =( select max(b_hit)+1 from board) where board_id = #{board_id}
    </update>


    <update id="boardModify">
        update board set b_category = #{b_category}, inquiry_category = #{inquiry_category}, b_title = #{b_title}, b_content = #{b_content}, b_date = SYSDATE where board_id = #{board_id}
    </update>

<!--    <sql id="criteria">-->
<!--        <trim prefix="(" suffix=") AND " prefixOverrides="OR">-->
<!--        <choose>-->
<!--            <when test="type == 'b_category'.toString()">-->
<!--                and b_category like concat('%', #{keyword}, '%')-->
<!--            </when>-->
<!--            <when test="type == 'b_title'.toString()">-->
<!--                and b_title like concat('%', #{keyword}, '%')-->
<!--            </when>-->
<!--            <when test="type == 'b_writer'.toString()">-->
<!--                and b_writer like concat('%', #{keyword}, '%')-->
<!--            </when>-->
<!--        </choose>-->
<!--        </trim>-->
<!--    </sql>-->

</mapper>
