<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>마취모: 회원가입</title>
    <script type="text/javascript" src="/login/jquery.min.js"></script>
    <script type="text/javascript" src="/login/jusoPopup.js" ></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
<th:block th:replace="fragments/header"></th:block>
<input type="hidden" id="naverMem" th:value="${naverMem}">
<input type="hidden" id="kakaoMem" th:value="${kakaoMem}">
<form name="reg_frm" id="reg_frm" class="table-primary" method="post" action="/loginT/joinProc">
    <input type="hidden" name="u_social" th:value="${userDto.getU_social()}">
<!--    <input type="text" name="u_social" th:value="${userDto.getU_social()}">-->
  <table align="center">
    <tr height="60" width="120">
      <td colspan="2" align="center">
        <h1>회원 가입 신청</h1>
      </td>
    </tr>
    <tr height="60">
      <td>User ID</td>
      <td>
        <input name="u_id" id="u_id" type="text" th:value="${userDto.getU_id()}" size="20">
          <button type="button" id="check_btn" onclick="sendRequest()">중복 체크</button>
          <span id="check_result"></span>
          <span class="fs-6 text-danger" th:text="${valid_u_id}"></span>

      </td>
    </tr>
    <tr height="60">
      <td>암    호</td>
      <td>
        <input name="u_password" type="password" size="20">*
          <div><span class="fs-6 text-danger" th:text="${valid_u_password}"></span></div>
      </td>
    </tr>
<!--     			<tr height="30">-->
<!--     				<td width="80">암호 확인</td>-->
<!--     				<td>-->
<!--     					<input name="pwd_check" type="password" size="20">*-->
<!--     				</td>-->
<!--     			</tr>-->
    <tr height="60">
      <td>이   름</td>
      <td>
        <input name="u_name" type="text" th:value="${userDto.getU_name()}" size="20">*
<!--        <input name="u_name" type="text" size="20">*-->
          <div><span class="fs-6 text-danger" th:text="${valid_u_name}"></span></div>
      </td>
    </tr>
      <tr height="60">
          <td>생년월일</td>
          <td>
              <input name="u_jumin" type="text" th:value="${userDto.getU_jumin()}" size="20" placeholder="예) 960429">*
              <div><span class="fs-6 text-danger" th:text="${valid_u_jumin}"></span></div>
          </td>
      </tr>
      <tr height="60">
          <td>전화번호</td>
          <td>
              <input name="u_phone" type="text" th:value="${userDto.getU_phone()}" size="20" placeholder="예) 01x-xxxx-xxxx">*
              <div><span class="fs-6 text-danger" th:text="${valid_u_phone}"></span></div>
          </td>
      </tr>
      <tr height="60">
          <td>닉네임</td>
          <td>
              <input name="u_nickname" type="text" th:value="${userDto.getU_nickname()}" size="20">*
              <div><span class="fs-6 text-danger" th:text="${valid_u_nickname}"></span></div>
          </td>
      </tr>
    <tr height="60">
        <td>E-mail</td>
        <td>
            <input name="u_email" type="text" th:value="${userDto.getU_email()}" size="60">
            <div><span class="fs-6 text-danger" th:text="${valid_u_email}"></span></div>
        </td>
    </tr>
    <tr height="60">
        <td>주    소</td>
        <td>
            <input name="u_address" id="u_address" type="text" th:value="${userDto.getU_address()}" size="40" readonly>
            <input type="button"  value="주소검색" onclick="goPopup();"> <br>
            <input name="u_address_sub" id="u_address_sub" type="text" th:value="${userDto.getU_address_sub()}" size="20" placeholder="상세 주소">
            <div><span class="fs-6 text-danger" th:text="${valid_u_address}"></span> <br></div>
        </td>
    </tr>
    <tr height="60">
      <td colspan="2" align="center">
        <input type="submit" id="insert_mem" value="등록" disabled="disabled">
        <input type="reset" value="다시입력">
        <input type="button" value="가입안함" onclick="javascript:window.location='/loginT/login'">
      </td>
    </tr>
  </table>
  </form>
<th:block th:replace="fragments/footer"></th:block>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>
<script type="text/javascript">
    function sendRequest(){
        var u_id = $("#u_id").val();
        console.log("u_id"+u_id+"test");
        if(u_id == null || u_id == "") return 0;
        $.ajax({
            url: "/loginT/checkUser"
            , type: "POST"
            , data: {"u_id": u_id}
            // dataType: 생략 가능(생략하면 자동으로 데이터타입 처리)
            // ,dataType: "json"
            , dataType: "text"
            //data: 응답받는 것(ex>json, text 등)
            , success: function (data) {
                if (data == "confirm") {
                    console.log(data);
                    $("#check_result").css("color", "blue");
                    // document.getElementById("check_result").innerHTML = "사용가능";
                    document.getElementById("check_result").innerHTML = "사용가능";
                    document.getElementById("check_btn").disabled = true;
                    document.getElementById("insert_mem").disabled = false;
                    document.getElementById("insert_mem").enabled = true;
                } else {
                    console.log(data);
                    $("#check_result").css("color", "red");
                    document.getElementById("check_result").innerHTML = "사용불가";
                    document.getElementById("insert_mem").disabled = true;
                }
            }
            , error: function (data) {
                document.getElementById("check_result").innerHTML = "<h3>ajax fail</h3>";
            }
        });

    }
    $(function(){
        var naverMem = $("#naverMem").val();
        if(naverMem == 'yes'){
            alert("가입된 계정이 없어 회원가입 절차를 진행합니다.");
        }
    });
</script>