<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>제품 정보 입력</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script type="text/javascript" src="/js/jusoPopup.js" ></script>
</head>
<body>

<div class="admin_content_main">
  <form action="/productEnroll/enroll" method="post" id="enrollForm" name="enrollForm">
<!--  <form action="/productEnroll/enroll" method="post" id="soldForm" name="soldForm">-->
    <input type="hidden" name="userId" th:value='11' />
<!--      <div id="subcategory" data-my-object="" ></div>-->
    <table th:border="1">
      <tr>
        <td colspan="2" th:align="center"><h1>판매 신청 폼</h1></td>
      </tr>


<!--        <tbody th:each="category : ${categories}">-->
        <tr>
            <td><label for="category1">1차 카테고리:</label></td>
            <td>
                <select id="category1" name="category1" onchange="selectSubcategory()">
<!--                <select id="category1" name="category1">-->
                    <!--                <select id="category1" name="category1">-->
                    <option value="">전체</option>
                    <option class="catego1" th:each="category : ${categories}" th:value="${category.cId}" th:text="${category.cName}"></option>
                </select>
            </td>
        </tr>
<!--        </tbody>-->

      <tr>
<!--        <td><label for="category2">2차 카테고리:</label></td>-->
        <td>2차 카테고리:</td>
        <td>
            <div th:each="category:${categories}">
<!--              <div th:id="'catego2-'+${category.cId}" style="display: none" th:each="subcategory:${subcategory[category.cId]}">-->
<!--              <div th:id="'catego2-'+${category.cId}" th:each="subcategory:${subcategory[category.cId]}">-->
              <select th:id="'category2-'+${category.cId}" style="display: none" name="category2">
                <option value="">전체</option>
<!--                <option th:each="catego:${subcategory}" th:value="${catego.cId}" th:text="${catego.cName}"></option>-->
                <option th:each="subcategory:${subcategory[category.cId]}" th:value="${subcategory.cId}" th:text="${subcategory.cName}"></option>

              </select>
<!--              </div>-->
            </div>
        </td>
      </tr>


        <tr>
        <td><label for="pName">제품명:</label></td>
        <td><input type="text" id="pName" name="pName" required /></td>
      </tr>
      <tr>
        <td><label for="pInfo">제품 정보:</label></td>
        <td><textarea id="pInfo" name="pInfo" required></textarea></td>
      </tr>
      <tr>
        <td><label for="pSaleType">판매 형태:</label></td>
        <td>
          <select id="pSaleType" name="pSaleType" required>
            <option value="1">경매</option>
            <option value="2">즉시 판매</option>
          </select>
        </td>
      </tr>

      <!-- Fields for Auction Sale Type -->
      <tr id="auctionFields" style="display: none;">
        <td><label for="pDurDate">판매 기간:</label></td>
        <td>
          <select id="pDurDate" name="pDurDate" required>
            <option value="7">7</option>
            <option value="14">14</option>
            <option value="21">21</option>
          </select>
        </td>
      </tr>
      <tr id="auctionStartPrice" style="display: none;">
        <td><label for="pBPrice">경매 시작 가격:</label></td>
        <td><input type="number" id="pBPrice" name="pBPrice" min="100" placeholder="최소 100원 이상부터 입력 가능합니다."  required /></td>
      </tr>

      <!-- Fields for Immediate Sale Type -->
      <tr id="immediateSaleFields" style="display: none;">
        <td><label for="pDirect">즉시 판매 가격:</label></td>
        <td><input type="number" id="pDirect" name="pDirect" min="100" placeholder="최소 100원 이상부터 입력 가능합니다." required /></td>
      </tr>
      <tr>
        <td><label for="pAccount">정산 계좌번호:</label></td>
        <td><input type="text" id="pAccount" name="pAccount" required /></td>
      </tr>
      <tr>
        <td><label for="pBank">은행명:</label></td>
        <td><input type="text" id="pBank" name="pBank" required /></td>
      </tr>

      <tr>
      <td>주    소</td>
      <td>
        <input name="pAddrPostcode" id="pAddrPostcode" type="text"  size="10" readonly placeholder="우편번호"> <br>
        <input name="pAddress" id="pAddress" type="text"  size="40" readonly>
        <input type="button"  value="주소검색" onclick="goPopup();"> <br>
        <input name="pAddressSub" id="pAddressSub" type="text" size="20" placeholder="상세 주소">
        <div><span class="fs-6 text-danger"></span> <br></div>
      </td>
    </tr>
      <tr>
        <td colspan="2" th:align="right" >
          <div class="btn_section">
            <button id="cancelBtn" class="btn">취 소</button>
            <!--      <button id="enrollBtn" class="btn enroll_btn">등 록</button>-->
            <input type="submit" value="등록">
          </div>
        </td>
      </tr>
  </table>
  </form>
  </div>
</body>


<script>
  // 1차 카테고리 선택 항목이 변경될 때 호출되는 함수
  function selectSubcategory() {
    // var category1 = document.getElementById("category1");
    // var category2 = document.getElementById("category2");
    // var selectedCategoryId = category1.value;
    // console.log("select:"+selectedCategoryId)
    // // Clear the existing options in category2
    // category2.innerHTML = "<option value=''>전체</option>";
    //
    // if (selectedCategoryId !== "") {
    //   var subcategories = $("#subcategory");
    //   console.log("sub");
    //   console.log("sub"+subcategories[0]);
    //   var selectedSubcategories = subcategories[0];
    //   if (selectedSubcategories !== null) {
    //       console.log("test2");
    //       console.log(typeof selectedSubcategories)
    //     for (var i = 0; i < selectedSubcategories.length; i++) {
    //         console.log("test2");
    //       var option = document.createElement("option");
    //       option.value = selectedSubcategories[i].cId;
    //       option.text = selectedSubcategories[i].cName;
    //       category2.appendChild(option);
    //     }
    //   }
    // }
      var catego = $(".catego1").val();
      console.log("cate:"+catego);
      $("#category2-"+catego).css("display","inline-block");
  }



</script>
<script>

  // $("option:selected", this).each(function () {
  //   var selectVal = $(this).val();
  //   cate2Select.append("<option value='" + selectVal + "'>전체</option>");
  //
  //   for(var i= 0; i < cate2Arr.length; i++){
  //     if (selectVal == cate2Arr[i].cateCodeRef){
  //       cate2Select.append("<option value='" + cate2Arr[i].cateCode + "'>"
  //                 + cate2Arr[i].cateName + "</option>");
  //     }
  //   }
  // })
  function toggleFields() {
    var saleType = $("#pSaleType").val();

    if (saleType === "1") {
      $("#auctionFields").show();
      $("#auctionStartPrice").show();
      $("#immediateSaleFields").hide();
    } else if (saleType === "2") {
      $("#auctionFields").hide();
      $("#auctionStartPrice").hide();
      $("#immediateSaleFields").show();
    } else {
      $("#auctionFields").hide();
      $("#auctionStartPrice").hide();
      $("#immediateSaleFields").hide();
    }
  }

  // Event listener for sale type change
  $("#pSaleType").on("change", toggleFields);

  // Initial invocation of toggleFields on page load (in case there's a pre-selected value)
  toggleFields();





  let enrollForm = $("#enrollForm")

  /* 취소 버튼 */
  $("#cancelBtn").click(function(){
    alert("등록 취소되었습니다.")
    history.back();
  });

  /* 상품 등록 버튼 */
  // $("#enrollBtn").on("click",function(e){
  //
  //   e.preventDefault();
  //   alert("등록 성공하였습니다.")
  //   enrollForm.submit();
  //
  // });

</script>
</html>
