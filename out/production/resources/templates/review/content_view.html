<!DOCTYPE html>
<!--<html xmlns:th="http://www.thymeleaf.org">-->
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/basic">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>
  <style>
    .fakeimg {
      height: 200px;
      background: #aaa;
    }
    .subReply {
      padding-left: 50px;
    }
  </style>
  <script>
    var id = getQueryStringObject().reviewId;
    function getQueryStringObject() {
      var a = window.location.search.substr(1).split('&');
      if (a == "") return {};
      var b = {};
      for (var i = 0; i < a.length; ++i) {
        var p = a[i].split('=', 2);
        if (p.length == 1)
          b[p[0]] = "";
        else
          b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
      }
      return b;
    }
    // /* 댓글쓰기 */
    // $(".reply_button_wrap").on("click", function(e){
    //
    //   e.preventDefault();
    //
    //   const userId = '${user.userId}';
    //   // 로그인 정보 들고와서 연결하기
    //   const reviewId = '${content_view.reviewId}';
    //   // 현재 게시글 번호
    //
    //   let popUrl = "/review/replyEnroll/" + userId + "?reviewId=" + reviewId;
    //   console.log(popUrl);
    //   let popOption = "width = 490px, height=490px, top=300px, left=300px, scrollbars=yes";
    //
    //   window.open(popUrl,"댓글 쓰기",popOption);
    //
    // });
  </script>

  <title>리뷰 내용</title>
  <link rel="stylesheet" th:href="@{/css/board.css}" />
</head>

<body>
<div class="container">
<h1>리뷰 내용</h1>
<table class="board_detail">
  <form method="post" action="modify_view">
    <input type="hidden" name="pageNum" th:value="${pageMaker.pageNum}">
    <input type="hidden" name="amount" th:value="${pageMaker.amount}">
    <input type="hidden" name="reviewId" th:value="${pageMaker.reviewId}">
  <tr>
    <td>리뷰 ID:</td>
    <td><span th:text="${content_view.reviewId}" ></span></td>
  </tr>
  <tr>
    <td>상품 ID:</td>
    <td><span th:text="${content_view.productId}"></span></td>
  </tr>
  <tr>
    <td>작성일:</td>
    <td><span th:text="${content_view.reviewDate}"></span></td>
  </tr>
  <tr>
    <td>조회수:</td>
    <td><span th:text="${content_view.reviewHit}"></span></td>
<!--    <td><span th:text="${hit}"></span></td>-->
  </tr>
  <tr>
    <td>작성자:</td>
    <td><span th:text="${content_view.reviewWritter}"></span></td>
  </tr>
  <tr>
    <td>제목:</td>
    <td><span th:text="${content_view.reviewTitle}"></span></td>
  </tr>
  <tr>
    <td>별점:</td>
    <td><span th:text="${content_view.reviewStar}"></span></td>
  </tr>
<!--  <tr>-->
<!--    <td>이미지:</td>-->
<!--    <td><span th:text="${content_view.reviewImg}"></span></td>-->
<!--  </tr>-->
<!--    <tr>-->
<!--      <td>이미지:</td>-->
<!--&lt;!&ndash;      <td><img th:src="${content_view.reviewImg}" alt="Review Image" /></td>&ndash;&gt;-->
<!--      <td><img th:src="'./display?fileName='+${content_view.reviewImg}"></td>-->
<!--    </tr>-->

    <tr>
    <td>내용:</td>
    <td><span th:text="${content_view.reviewContent}"></span></td>
  </tr>

  <tr>
    <td colspan="3">
      <input class="btn" type="submit" value="수정" formaction="modify_view" style="width: 100px; height: 30px;">
      <input class="btn" type="submit" value="목록보기" formaction="list" style="width: 100px; height: 30px;">
      <input class="btn" type="submit" value="삭제" formaction="delete" style="width: 100px; height: 30px;">
<!--      <input hidden="hidden" th:value="${content_view.getId()}" id="id">-->
    </td>
  </tr>
  </form>

    <tr>

<!--        <div class="content_bottom">-->
<!--            <div class="reply_subject">-->
<!--              <h2>댓글</h2>-->
<!--            </div>-->
<!--        </div>-->
<!--&lt;!&ndash;        로그인 해야 볼 수 있도록&ndash;&gt;-->
<!--&lt;!&ndash;        <div th:if="${member != null}">&ndash;&gt;-->
<!--          <div class="reply_button_wrap">-->
<!--            <button>댓글 쓰기</button>-->
<!--          </div>-->
<!--&lt;!&ndash;        </div>&ndash;&gt;-->

      <!--/* 댓글 작성 */-->
<!--      <th:block layout:fragment="content">-->
<!--      <td colspan="3">-->
<!--      <div class="cm_write">-->
<!--        <fieldset>-->
<!--          <legend class="skipinfo">댓글 입력</legend>-->
<!--          <div class="cm_input">-->
<!--            <p><textarea id="content" name="content" onkeyup="countingLength(this);" cols="90" rows="4" placeholder="댓글을 입력해 주세요."></textarea></p>-->
<!--            <span><button type="button" class="btns" onclick="saveComment();">등 록</button> <i id="counter">0/300자</i></span>-->
<!--          </div>0-->
<!--        </fieldset>-->
<!--      </div>-->
<!--      </th:block>-->



      <!-- Comments Form -->
      <div class="card my-4">
        <h5 class="card-header">Leave a Comment:</h5>
        <div class="card-body">
          <form name="comment-form" action="/board/comment/write" method="post" autocomplete="off">
            <div class="form-group">
              <input type="hidden" name="c_reviewId" th:value="*{content_view.reviewId}" />
              <textarea name="content" class="form-control" rows="3"></textarea>
            </div>
<!--            <button type="submit" class="btn btn-primary">Submit</button>-->
            <input type="submit" class="btn btn-primary" formaction="board/comment/write">Submit</input>
          </form>
        </div>
      </div>

    </tr>


</table>
</div>
<script>
  $(document).ready(function () {
    getCommentList();
  })

  function getCommentList() {
    var reviewId = $('input[name=c_reviewId]').val();
    $.ajax({
      type: 'GET',
      url : 'getCommentList',
      data: {reviewId},
      success: function (result) {
        console.log(result);
        for (var i=0; i<result.length; i++){
          var str = "<div class=\"comment\">"
          str += result[i].content+"</div></hr>"
          $("#comment").append(str);
        }
      },
      error: function (result) {
      },
      complete: function () {
      }
    })

  }











  //
  // // 댓글 길이 카운팅
  // function countingLength(content) {
  //   if (content.value.length > 300) {
  //     alert('댓글을 300자 이하로 입력해 주세요.');
  //     content.value = content.value.substring(0, 300);
  //     content.focus();
  //   }
  //   document.getElementById('counter').innerText = content.value.length + '/300자';
  // }
  //
  //
  // // 댓글 저장
  // function saveComment() {
  //
  //   const content = document.getElementById('content').value;
  //   // isValid(content, '댓글');
  //
  //   const reviewId = document.getElementById("reviewId").innerText
  //   // const reviewId = "${content_view.reviewId}";
  //   const id = document.getElementById("id").value;
  //   const params = {
  //     id : id,
  //     reviewId : reviewId,
  //     content : content,
  //     writer : '홍길동'
  //   }
  //   var eee = JSON.stringify(params);
  //   console.log("params@@@@@@@@@"+params);
  //   console.log("reviewId@@@@@"+reviewId);
  //   console.log("content@@@@@@@"+content);
  //   console.log("eee@@@@@@@"+eee);
  //
  //   $.ajax({
  //     // url : "/review/"+reviewId+"/comments",
  //     url : `/review/${reviewId}/comments`,
  //     type : 'post',
  //     contentType : 'application/json; charset=utf-8',
  //     dataType : 'json',
  //     data : JSON.stringify(params),
  //     // data : params,
  //     async : false,
  //     success : function (response) {
  //       console.log(response);
  //     },
  //     error : function (request, status, error) {
  //       console.log(error)
  //     }
  //   })
  // }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
</body>
</html>
